<!--
 * @Date: 2024-05-20 16:52:23
 * @Author: DarkskyX15
 * @LastEditTime: 2024-05-20 21:03:02
-->

# 模块编写规范  

*最后更新于2024/5/20*  

## 接口函数要求  

### launch / stop  

启动函数将被提供给核心，并于地图的触发器函数链接。  
停止函数供模块本身调用，同时也于核心的卸载函数中调用以在模块停止后再进行模块的卸载。  

模块在*启动前和停止后***不能**对外部能影响到命令执行或游玩的所有数据有任何影响，或者说**只能**修改storage中的data和修改属于模块的scoreboard的**非**setdisplay属性。  
举例说明，在启动前和停止后，以下是**不推荐**的行为：  

- 修改scoreboard的setdisplay
- 召唤标记性或功能性的实体
- 执行title以显示信息
- 创建和删除队伍，或修改队伍属性
- 给玩家分队或添加模块内使用的tag
- 修改实体nbt值
- **······**

因此，launch / stop 函数应该完成上述在启动前和停止后不应该做的行为，来初始化游戏或进行游戏后清理。  

**注意：** launch / stop 函数必须直接放置在命名空间的根文件夹内。

### install / uninstall  

安装和卸载函数将在核心的安装和卸载函数中调用。  

install函数主要负责模块所需要的数据（包括scoreboard和storage中的data）的初始化，可以考虑在该函数中提前创建team，并在launch函数中修改team属性来初始化team（或将这两个步骤都放至launch中执行）。  

uninstall函数负责注销所有注册的数据。

**注意：** install / uninstall 函数必须直接放置在命名空间的根文件夹内。  

## 其他函数要求  

尽可能减少直接堆放在命名空间根文件夹内的函数文件。  
同时若有长期维护或多人合作的需求，则**建议**编写详细的注释或创建文档。  

## 事件处理函数规范  

**该类函数的执行者和执行位置为触发事件的实体及其位置**  
建议将事件处理函数集中存放，或按照功能放至各自的划分中。  

事件的注册应遵循以下格式：  

```mcfunction
#~EVENT <event-id1>/<event-id2>/...
```

若与多个事件相关，则用`'/'`分隔事件ID。  
建议将注册标识集中放在文件开头，以增加可读性。  

## 变量使用规范  

预处理器通过配置文件设置的文本替换实现类似变量的效果。  

注册格式：  

```mcfunction
#~VARIABLE <identifier> <GlobalID>
kill $(<identifier>)
```

预处理器将会把与`identifier`标识符匹配的类似原版宏格式的字符串替换为具体值。  
`identifier`仅在该注册的函数文件内生效，`GlobalID`在该模块的命名空间内必须存在并唯一。  
**注意：** 大量坐标相关的变量替换建议通过召唤标识性的盔甲架，再通过调整命令执行位置和相对坐标替代。

## 配置文件  

配置文件被保存在`<namespace>/config.txt`文件内。  
文件内每一行为一对`GlobalID（下文称为属性）`和字符串值，两者用空格分隔，这也表明字符串值和属性中都不允许出现空格。  

每个模块的配置文件内必须有`GAME_NAME`属性来表示该模块的游戏名称，以提供给核心在与地图链接时使用。**特殊地**，该属性对应的字符串值中的`_（下划线）`将在解析后被替换成空格。
